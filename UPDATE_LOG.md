# 系统更新说明

## 更新时间
2026年2月4日

## 更新内容

### 1. Excel 数据处理 ✅
- ✅ 创建 `process_excel.py` 脚本,正确读取 Excel 文件
- ✅ 解析表格数据,提取564条乡村运营记录
- ✅ 生成标准化的 JSON 格式数据
- ✅ 保存到 `data/data.json` 和 `data/stats.json`

**数据结构**:
- 总村庄数: 564个
- 覆盖区域: 85个区域
- 主要字段: 村庄名称、所属区域、运营主体、业态类型、租金模式等

### 2. 杭州地图集成 ✅
- ✅ 使用 `data/hangzhou.json` 地图数据
- ✅ 在主页面添加地图容器
- ✅ 通过 ECharts 可视化展示杭州市各区县
- ✅ 地图上标记运营村庄数量分布
- ✅ 支持地图缩放和拖动交互

**地图特性**:
- 热力图显示各区域村庄密度
- 散点标记各区中心位置
- 悬停提示详细数据
- 自适应颜色渐变

### 3. 数据汇总展示 ✅
- ✅ 主页概览卡片显示核心指标
  - 运营村庄总数: 564
  - 覆盖区域数量: 85
  - 主要业态类型: 土特产
  - 数据更新率: 100%

- ✅ 新增4个可视化图表:
  1. **杭州市分布地图** - 地理位置和密度展示
  2. **运营主体性质分布** - 饼图展示
  3. **各区域村庄数量** - 柱状图,按数量排序
  4. **业态类型分布** - 横向柱状图
  5. **租金模式分布** - 环形饼图

- ✅ 数据表格展示
  - 列出前50条详细记录
  - 包含村庄名称、区域、业态、负责人、状态等信息
  - 状态标签使用颜色区分

### 4. 技术改进
- ✅ 后端支持 JSON 文件优先加载
- ✅ 前端数据降级策略: JSON → 模拟数据
- ✅ 响应式图表自适应窗口大小
- ✅ 统一的数据处理流程

## 使用方法

### 数据更新流程
```bash
# 1. 将新的 Excel 文件放入 data 目录
cp 新文件.xls data/0501（汇总）乡村运营行政村信息表(已开展运营).xls

# 2. 运行数据处理脚本
python3 process_excel.py

# 3. 启动服务器查看效果
./start.sh
# 或
python3 server.py
```

### 访问地址
- 本地: http://localhost:5002
- 局域网: http://your-ip:5002

## 文件清单

### 新增文件
- `process_excel.py` - Excel 数据处理脚本
- `script_new.js` → `script.js` - 更新的前端脚本
- `script_old.js` - 旧版本备份

### 修改文件
- `index.html` - 添加地图容器和新图表区域
- `server.py` - 支持 JSON 数据加载
- `data/data.json` - 生成的数据文件 (564条记录)
- `data/stats.json` - 生成的统计数据

### 已有资源
- `data/hangzhou.json` - 杭州市地图 GeoJSON 数据
- `data/0501（汇总）乡村运营行政村信息表(已开展运营).xls` - 源 Excel 数据

## 下一步优化建议

1. **村庄精确定位**
   - 添加每个村庄的具体经纬度数据
   - 在地图上标注具体村庄位置点
   - 支持点击查看村庄详情

2. **数据筛选和搜索**
   - 添加区域筛选下拉菜单
   - 支持村庄名称搜索
   - 业态类型多选过滤

3. **动态更新**
   - 定时自动刷新数据
   - Excel 文件监听自动处理
   - WebSocket 实时推送更新

4. **数据导出**
   - 支持筛选结果导出为 Excel
   - 生成 PDF 报表
   - 数据对比分析功能

5. **移动端适配**
   - 响应式布局优化
   - 触摸手势支持
   - 移动端专属界面

## 技术栈

- **后端**: Flask (Python 3)
- **前端**: HTML5 + JavaScript + ECharts 5.4.3
- **数据处理**: Pandas + xlrd
- **地图**: ECharts 地图组件 + GeoJSON
- **样式**: 原生 CSS3

## 注意事项

1. Excel 文件路径硬编码在 `server.py` 中,修改数据源需要更新路径
2. 地图数据来自 `data/hangzhou.json`,确保文件完整
3. 首次运行需要安装依赖: `pip3 install flask pandas xlrd`
4. 数据更新后需要重新运行 `process_excel.py` 生成新的 JSON
5. 生产环境建议使用 gunicorn 或 uwsgi 替代 Flask 开发服务器

## 问题反馈

如有问题或建议,请在项目中提出 Issue 或 Pull Request。
